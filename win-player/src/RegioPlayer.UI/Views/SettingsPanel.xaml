<UserControl x:Class="RegioPlayer.UI.Views.SettingsPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:RegioPlayer.UI.Converters">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#2a2a2a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style TargetType="Button">
            <Setter Property="Background" Value="#2a2a2a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3a3a3a"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#2a2a2a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
    </UserControl.Resources>

    <Border Background="#CC000000" 
            BorderBrush="#555" 
            BorderThickness="1" 
            CornerRadius="8">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="⚙️" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Player Settings" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                
                <Button Content="✖" 
                        HorizontalAlignment="Right"
                        Width="30" Height="30"
                        Margin="20,0,0,0"
                        Command="{Binding CloseSettingsCommand}"
                        ToolTip="Close Settings"/>
            </StackPanel>

            <!-- Settings Content -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="400">
                <StackPanel>
                    <!-- Player Information -->
                    <GroupBox Header="Player Information" Foreground="White" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Version: " Width="120"/>
                                <TextBlock Text="{Binding CurrentVersion}" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Screen Key: " Width="120"/>
                                <TextBlock Text="{Binding CurrentScreenKey}" FontFamily="Consolas" FontSize="11"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Current Playlist: " Width="120"/>
                                <TextBlock Text="{Binding CurrentPlaylistName}"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Playlist Items: " Width="120"/>
                                <TextBlock Text="{Binding CurrentPlaylistItemCount}"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Backend Status: " Width="120"/>
                                <TextBlock Text="{Binding BackendConnectionStatus}" 
                                          Foreground="{Binding BackendConnectionColor}" 
                                          FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Internet Status: " Width="120"/>
                                <TextBlock Text="{Binding InternetConnectionStatus}" 
                                          Foreground="{Binding InternetConnectionColor}" 
                                          FontWeight="Bold"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- Network Settings -->
                    <GroupBox Header="Network Settings" Foreground="White" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <TextBlock Text="API Base URL:"/>
                            <TextBox Text="{Binding Configuration.ApiBaseUrl, UpdateSourceTrigger=PropertyChanged}"/>
                            
                            <TextBlock Text="WebSocket URL:"/>
                            <TextBox Text="{Binding Configuration.WebSocketUrl, UpdateSourceTrigger=PropertyChanged}"/>
                            
                            <TextBlock Text="Sync Interval (seconds):"/>
                            <TextBox Text="{Binding Configuration.SyncIntervalSeconds, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Media Settings -->
                    <GroupBox Header="Media Settings" Foreground="White" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <TextBlock Text="Cache Size Limit (GB):"/>
                            <TextBox Text="{Binding Configuration.MediaCacheMaxSizeGB, UpdateSourceTrigger=PropertyChanged}"/>
                            
                            <CheckBox Content="Enable Hardware Acceleration" 
                                     IsChecked="{Binding Configuration.EnableHardwareAcceleration}"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBlock Text="Current Cache Size: " VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding CacheSizeText}" FontWeight="Bold" VerticalAlignment="Center"/>
                                <Button Content="Clear Cache" 
                                        Command="{Binding ClearCacheCommand}"
                                        Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- Kiosk Settings -->
                    <GroupBox Header="Kiosk Settings" Foreground="White" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <CheckBox Content="Enable Kiosk Mode" 
                                     IsChecked="{Binding Configuration.EnableKioskMode}"/>
                            
                            <TextBlock Text="Keep Alive Interval (seconds):"/>
                            <TextBox Text="{Binding Configuration.KeepAliveIntervalSeconds, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Logging Settings -->
                    <GroupBox Header="Logging Settings" Foreground="White" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <CheckBox Content="Enable Logging" 
                                     IsChecked="{Binding Configuration.EnableLogging}"/>
                            
                            <TextBlock Text="Log Level:"/>
                            <ComboBox SelectedValue="{Binding Configuration.LogLevel}">
                                <ComboBoxItem Content="Trace" Tag="Trace"/>
                                <ComboBoxItem Content="Debug" Tag="Debug"/>
                                <ComboBoxItem Content="Information" Tag="Information"/>
                                <ComboBoxItem Content="Warning" Tag="Warning"/>
                                <ComboBoxItem Content="Error" Tag="Error"/>
                                <ComboBoxItem Content="Critical" Tag="Critical"/>
                            </ComboBox>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>

            <!-- Status Message -->
            <TextBlock Grid.Row="2" 
                      Text="{Binding StatusMessage}" 
                      HorizontalAlignment="Center"
                      Foreground="#cccccc"
                      Margin="0,10,0,0"
                      Visibility="{Binding StatusMessage, Converter={x:Static converters:StringToVisibilityConverter.Instance}}"/>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="3" 
                       Orientation="Horizontal" 
                       HorizontalAlignment="Center"
                       Margin="0,20,0,0">
                
                <Button Content="💾 Save Settings" 
                        Command="{Binding SaveSettingsCommand}"
                        IsEnabled="{Binding IsLoading, Converter={x:Static converters:InverseBooleanConverter.Instance}}"
                        Background="#4CAF50"
                        BorderBrush="#45a049"/>
                
                <Button Content="🔄 Restart Player" 
                        Command="{Binding RestartPlayerCommand}"
                        Background="#FF9800"
                        BorderBrush="#e68900"/>
                
                <Button Content="🔗 Reset Pairing" 
                        Command="{Binding ResetPairingCommand}"
                        IsEnabled="{Binding IsLoading, Converter={x:Static converters:InverseBooleanConverter.Instance}}"
                        Background="#9C27B0"
                        BorderBrush="#7B1FA2"
                        ToolTip="Clear all pairing data and return to pairing mode"/>
                
                <Button Content="❌ Cancel" 
                        Command="{Binding CloseSettingsCommand}"
                        Background="#f44336"
                        BorderBrush="#da190b"/>
            </StackPanel>

            <!-- Loading Overlay -->
            <Grid Grid.RowSpan="4"
                  Background="#80000000"
                  Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Ellipse Width="40" Height="40" 
                             Fill="Transparent" 
                             Stroke="White" 
                             StrokeThickness="3"
                             Margin="0,0,0,15">
                        <Ellipse.RenderTransform>
                            <RotateTransform x:Name="LoadingRotation" CenterX="20" CenterY="20"/>
                        </Ellipse.RenderTransform>
                        <Ellipse.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetName="LoadingRotation"
                                                       Storyboard.TargetProperty="Angle"
                                                       From="0" To="360" Duration="0:0:1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Ellipse.Triggers>
                    </Ellipse>
                    
                    <TextBlock Text="Processing..." 
                               Foreground="White" 
                               FontSize="16"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>